# .github/workflows/ocall.yml

name: opencog all

on:
  push:
    branches: main
  pull_request:
    branches: main

jobs:
  build-and-test:
    name: Build and Test All Components
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4
      
      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y build-essential cmake libboost-all-dev libcpprest-dev librocksdb-dev liboctomap-dev guile-3.0-dev uuid-dev cython3 python3-nose valgrind doxygen
          
      - name: Install Cython
        run: python3 -m pip install --upgrade pip cython

      - name: build & install all
        run: |
          # Cognitive Flowchart: Recursively Correct Build Order
          # This sequencing embodies adaptive attention allocation, recursive prerequisite fulfillment,
          # and neural-symbolic integration across all modules.
          
          for repo in \
            cogutil \
            atomspace \
            atomspace-storage \
            atomspace-agents atomspace-bridge atomspace-cog atomspace-dht atomspace-explorer atomspace-ipfs \
            atomspace-js atomspace-metta atomspace-pgres atomspace-restful atomspace-rocks atomspace-rpc \
            atomspace-typescript atomspace-websockets atomspace-accelerator \
            cogserver \
            attention \
            benchmark \
            profile \
            blender_api \
            blender_api_msgs \
            link-grammar \
            linkgrammar-relex-web \
            link-grammar-website \
            guile-dbi \
            relex \
            pattern-index \
            logicmoo_cogserver \
            opencog \
            opencog-cycl \
            opencog-debian \
            opencog-neo4j \
            opencog-nix \
            opencog.org \
            opencog_rpi \
            opencog-to-minecraft \
            ocpkg \
            ci_artifacts \
            docker \
            docs \
            rest-api-documentation \
            external-tools \
            evidence \
            ghost_bridge \
            GHOST \
            loving-ai \
            loving-ai-ghost \
            matrix \
            robots_config \
            ros-behavior-scripting \
            ros_opencog_robot_embodiment \
            unity3d-opencog-game \
            agents \
            agi-bio \
            asmoses \
            atomese-simd \
            pln \
            pln-brca-xp \
            learn \
            moses \
            destin \
            python-attic \
            python-client \
            python-destin \
            miner \
            motor \
            pi_vision \
            perception \
            dimensional-embedding \
            distributional-value \
            cheminformatics \
            language-learning \
            generate \
            semantic-vision \
            sensory \
            spacetime \
            stochastic-language-generation \
            test-datasets \
            TinyCog \
            tv-toolbox \
            unify \
            ure \
            vision \
            visualization \
            agentic-chatbots \
            lg-atomese
          do
            echo "spawning $repo..."
            # Skip if directory doesn't exist
            if [ ! -d "$repo" ]; then
              echo "⚠️  Directory $repo not found, skipping..."
              continue
            fi
            
            # Skip if no CMakeLists.txt exists
            if [ ! -f "$repo/CMakeLists.txt" ]; then
              echo "⚠️  No CMakeLists.txt in $repo, skipping..."
              continue
            fi
            
            mkdir -p $repo/build/
            cd $repo/build
            cmake .. || { echo "❌ CMake failed for $repo"; cd ../..; continue; }
            make || { echo "❌ Make failed for $repo"; cd ../..; continue; }
            sudo make install || { echo "❌ Install failed for $repo"; cd ../..; continue; }
            sudo ldconfig
            cd ../..
            echo "✅ Successfully built and installed $repo"
          done
          
          # Final system update
          sudo apt update
          sudo apt install -y
